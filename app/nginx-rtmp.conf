user www-data;
worker_processes auto;
pid /run/nginx-rtmp.pid;

# Load RTMP module with absolute path
load_module /usr/lib/nginx/modules/ngx_rtmp_module.so;

events {
    worker_connections 1024;
}

rtmp {
    server {
        listen 1935;
        chunk_size 4096;

        application live {
            live on;

            # save incoming streams to disk
            record all;
            record_path /var/www/html/recordings;
            record_unique on;

            # HLS output - optimized for smooth live streaming
            hls on;
            hls_path /var/www/html/hls;
            hls_fragment 2s;           # Smaller fragments for smoother playback
            hls_playlist_length 20s;   # Keep 10 fragments (20s total)
            hls_sync 100ms;            # Timestamp synchronization
        }
    }
}
