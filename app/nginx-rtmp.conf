user www-data;
worker_processes auto;
pid /run/nginx-rtmp.pid;

# Load RTMP module with absolute path
load_module /usr/lib/nginx/modules/ngx_rtmp_module.so;

events {
    worker_connections 1024;
}

rtmp {
    server {
        listen {{ RTMP_PORT | default(1935) }};
        chunk_size 4096;

        application live {
            live on;

            # save incoming streams to disk
            record all;
            record_path /var/www/html/recordings;
            record_unique on;

            # HLS output - optimized for smooth, stable streaming
            hls on;
            hls_path /var/www/html/hls;
            hls_fragment 4s;           # 4-second segments for stability
            hls_playlist_length 60s;   # Keep 15 fragments (60s buffer)
            hls_sync 100ms;            # Timestamp synchronization
        }
    }
}
